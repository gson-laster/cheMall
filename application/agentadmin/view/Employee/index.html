<!-- page specuific plugin scripts -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>福满家代理后台 </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="__AGENT_ADMIN_STATIC__css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="__AGENT_ADMIN_STATIC__css/font-awesome.min.css" />
    <link rel="stylesheet" href="__AGENT_ADMIN_STATIC__css/font-awesome.min.css" />
    <link rel="stylesheet" href="__AGENT_ADMIN_STATIC__css/layer.css" />
    <link rel="stylesheet" href="__AGENT_ADMIN_STATIC__css/laydate.css" />
    <!--[if IE 7]>
		  <link rel="stylesheet" href="__ADMIN_STATIC__/assets/css/font-awesome-ie7.min.css" />
		<![endif]-->
    <link rel="stylesheet" href="__AGENT_ADMIN_STATIC__css/ace-rtl.min.css" />
    <link rel="stylesheet" href="__AGENT_ADMIN_STATIC__css/ace-skins.min.css" />
    <link rel="stylesheet" href="__AGENT_ADMIN_STATIC__css/style.css" />
    <link rel="stylesheet" href="__AGENT_ADMIN_STATIC__css/ace.min.css" />
    <script src="__AGENT_ADMIN_STATIC__js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="__AGENT_ADMIN_STATIC__js/jquery-2.0.3.min.js"></script>
    <!--[if lte IE 8]>
		  <link rel="stylesheet" href="__ADMIN_STATIC__/assets/css/ace-ie.min.css" />
		<![endif]-->
    <script src="__AGENT_ADMIN_STATIC__js/ace-extra.min.js"></script>
    <!--[if lt IE 9]>
		<script src="__ADMIN_STATIC__/assets/js/html5shiv.js"></script>
		<script src="__ADMIN_STATIC__/assets/js/respond.min.js"></script>
		<![endif]-->
    <!--[if !IE]> -->
    <!-- <![endif]-->
    <!--[if IE]>
         <script type="text/javascript">window.jQuery || document.write("<script src='__ADMIN_STATIC__/assets/js/jquery-1.10.2.min.js'>"+"<"+"script>");</script>
        <![endif]-->
    <script type="text/javascript">
    if ("ontouchend" in document) document.write("<script src='__AGENT_ADMIN_STATIC__js/jquery.mobile.custom.min.js'>" + "<" + "script>");
    </script>
    <script src="__AGENT_ADMIN_STATIC__js/bootstrap.min.js"></script>
    <script src="__AGENT_ADMIN_STATIC__js/typeahead-bs2.min.js"></script>
    <!--[if lte IE 8]>
		  <script src="__ADMIN_STATIC__/assets/js/excanvas.min.js"></script>
		<![endif]-->
    <script src="__AGENT_ADMIN_STATIC__js/jquery.ui.touch-punch.min.js"></script>
    <script src="__AGENT_ADMIN_STATIC__js/jquery-ui-1.10.3.custom.min.js"></script>
    <script src="__AGENT_ADMIN_STATIC__js/jquery-ui-1.10.3.full.min.js"></script>
    <script src="__AGENT_ADMIN_STATIC__js/jquery.icheck.min.js"></script>
    <script src="__AGENT_ADMIN_STATIC__js/ace-elements.min.js"></script>
    <script src="__AGENT_ADMIN_STATIC__js/ace.min.js"></script>
    <script src="__AGENT_ADMIN_STATIC__js/layer.js" type="text/javascript"></script>
    <script src="__AGENT_ADMIN_STATIC__js/laydate.js" type="text/javascript"></script>
    <script src="__AGENT_ADMIN_STATIC__js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="__PUBLIC__/static/js/util.js" type="text/javascript"></script>



<script type="text/javascript" src="__AGENT_ADMIN_STATIC__js/bootstrap.min.js"></script>
<script type="text/javascript" src="__AGENT_ADMIN_STATIC__js/typeahead-bs2.min.js"></script>
<script type="text/javascript" src="__AGENT_ADMIN_STATIC__js/ace-extra.min.js"></script>
<!--<script src="__AGENT_ADMIN_STATIC__js/jquery.js"></script>
<script src="__AGENT_ADMIN_STATIC__js/jquery.js"></script>-->
<script src="__AGENT_ADMIN_STATIC__js/jquery.dataTables.min.js"></script>
<script src="__AGENT_ADMIN_STATIC__js/jquery.dataTables.bootstrap.js"></script>
<script type="text/javascript" src="__AGENT_ADMIN_STATIC__js/H-ui.js"></script>
<!--<script type="text/javascript" src="__AGENT_ADMIN_STATIC__js/H-ui.admin.js"></script>-->
<!--<script type="text/javascript" src="__AGENT_ADMIN_STATIC__js/webuploader.js"></script>-->
</head>
<body>
<style>
    .td{
        margin: 12px;
    }
    .none{
    	display: none;
    }
</style>
<div class="page-content clearfix">
    <div id="Member_Ratings">
        <div class="d_Confirm_Order_style">
            <!---->
            <div class="border clearfix">
                    <span class="l_f">
                      <a href="javascript:;" id="member_add" class="btn btn-warning"><i class="icon-plus"></i>添加员工</a>
                      <a href="javascript:;" class="btn btn-danger" onclick="deletesAll(this)" data-action='{:url('delEmployee')}'><i class="icon-trash"></i>批量删除</a>
                      <a href="javascript:;" onclick="createservice()" id="createservice" class="btn btn-warning none">设为客服</a>
                    </span><i id="warn" class="none" style="line-height: 56px; color: red;">从以下列表勾选一位成为客服,客服仅设置一次,且不能更改,谨慎操作</i>
                <span class="r_f">共：<b></b>条</span>
            </div>
            <!---->
            <div class="table_menu_list">
                <table class="table table-striped table-bordered table-hover" id="sample-table">
                    <thead>
                    <tr>
                        <th width="25"><label><input type="checkbox" class="ace"><span class="lbl"></span></label></th>
                        <th width="80">ID</th>
                        <th width="100">用户名</th>
                        <th width="80">昵称</th>
                        <th width="180">代理ID</th>
                        <th width="70">状态</th>
                        <th width="250">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    {volist name="list" id="u"}
                    <tr>
                        <td><label><input type="checkbox" name="ids[]" value="{$u.id}" class="ace"><span class="lbl"></span></label></td>
                        <td>{$u.id}</td>
                        <td><u style="cursor:pointer" class="text-primary" onclick="member_show('张三','member-show.html','10001','500','400')"> {$u.username}</u></td>
                        <td>{$u.nickname}</td>
                        <td>{$u.agent_id}</td>
                        <td class="td-status"><span class="label {if condition="$u['status'] eq 1"}label-success{else/}label-defaunt{/if} radius">{if condition="$u['status'] eq '0'"}禁用{else/}正常{/if}</span></td>
                        <td class="td-manage">
                            <a onClick="{if condition="$u['status'] eq '1'"}member_stop(this,{$u.id}){else/}member_start(this,{$u.id}){/if}" href="javascript:;" title="{if condition="$u['status'] eq 0 "}停用{else/}启用{/if}" class="btn btn-xs{if condition="$u['status'] eq 1"} btn-success{else/} btn-defaunt{/if}"><i class="icon-ok bigger-120"></i></a>
                            <!--<a href="{:url('shippingarea',['id'=>$u.id])}" class="btn btn-xs btn-info"><i class="icon-th bigger-120"></i></a>-->
                            <a title="编辑" onclick="member_edit({$u.id})" href="javascript:;" class="btn btn-xs btn-info"><i class="icon-edit bigger-120"></i></a>
                            <a title="删除" href="javascript:;" onclick="member_del(this,{$u.id})" class="btn btn-xs btn-warning"><i class="icon-trash  bigger-120"></i></a>
                        </td>
                    </tr>
                    {/volist}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!--添加用户图层-->
<div class="add_menber" id="add_menber_style" style="display:none">
    <ul class=" page-content">
        <li class="adderss"><label class="label_name">用户名：</label><span class="add_name"><input name="username" type="text"  class="text_add" style=" width:350px" required data-title="用户名" data-role="add"/></span>
            <div class="prompt r_f"></div>
        </li>
        <li class="adderss"><label class="label_name">昵称：</label><span class="add_name" ><input name="nickname" type="text"  class="text_add" style=" width:350px" required data-title="昵称" data-role="add"/></span>
            <div class="prompt r_f"></div>
        </li>
        <li class="adderss"><label class="label_name">密码：</label><span class="add_name"><input id="password" name="password" type="password"  class="text_add" style=" width:350px" required data-title="密码" data-role="add"/></span>
            <div class="prompt r_f"></div>
        </li>
         <li class="adderss"><label class="label_name">确认密码：</label><span class="add_name"><input id="confirm" name="password_confirm" type="password"  class="text_add" style=" width:350px" required data-title="确认密码" data-role="add"/></span>
            <div class="prompt r_f"></div>
        </li>
        <li><label class="label_name">状&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;态：</label><span class="add_name">
     <label><input name="status" type="radio" checked="checked" value="1" class="ace" data-role="add" id="normal"/><span class="lbl">开启</span></label>&nbsp;&nbsp;&nbsp;
            <label><input name="status"type="radio" class="ace" value="0" data-role="add" id="forbidden"/><span class="lbl">关闭</span></label></span>
            <div class="prompt r_f"></div>
        </li>
    </ul>
</div>
</body>
<script type="text/javascript">
	//设置客服
	//没有客服
	var haveservice=true;
        {volist name="list" id="u"}
        if ({$u.is_service}==1) {
        	haveservice=false;
        }
        {/volist}
    		if(haveservice){
    			$("#createservice").removeClass('none');
    			$("#warn").removeClass('none');
        }
        function createservice(){
		    		var service_arr=[];
					var service=$("tbody input:checked");
					service.each(function(){
						if ($(this).prop('checked')) {
							service_arr.push($(this));
						}
					})
					if(service_arr.length==1){
						$.ajax({
							type:"Post",
							data:{id:service_arr[0].val()},
							url:'{:url('createService')}',
							async:true,
							success:function(data){
								console.log(data)
							}
						});
					}
			}
</script>
<script type="text/javascript">
//	console.log(uid);

    /*用户-添加*/
    $('#member_add').on('click', function() {
      openPanle('add', null);
      layer.open({
        type: 1,
        title: '添加员工',
        maxmin: true,
        shadeClose: true, //点击遮罩关闭层
        area: ['z', '400px'],
        content: $('#add_menber_style'),
        btn: ['提交', '取消'],
        yes: function(index, layero) {
          var bool=false;
          var json_={};
          var input=$('#add_menber_style input');
          input.each(function(){
          	if ($(this).val()=="") {
          		layer.msg("请输入关键项");
          		bool=true;
          		return true;
          	}else{
          		json_[$(this).attr('name')]=$(this).val();
          	}
          });
          var password=$("#password");
          if (password.val()!=$("#confirm").val()&&!bool) {
          		layer.msg("请输入相同的密码");
          		bool=true;
          };
          if (bool) {
          	return false;
          }
          var input=$('#add_menber_style input[type=radio]');
          input.each(function(){
          	if($(this).prop('checked')){
          		json_.status=$(this).val();
          	}
          })
			$.ajax({
				type:"Post",
				url:'{:url('saveEmployee')}',
				async:true,
				data:json_,
				success:function(data){
					layer.close(index);
					layer.msg(data.msg);
			 		setTimeout(function(){location.href=data.url},1500);
					console.log(data);
				}
			});
        }
      });
    });



    /*员工删除*/
    function member_del(obj,id) {
      layer.confirm('确认删除吗?',function (index) {
//      adminAjax('Get','{:url("delEmployee")}',util.jsonToUrlStr({"id":id}),false,function (res) {
//      	console.log(res);
//        $(obj).parents("tr").remove();
//        layer.msg('已删除',{
//          icon:1,
//          time:1000
//        });
//
//      })
$.ajax({
	type:"Get",
	data:{'id':id},
	url:'{:url('delEmployee')}',
	async:true,
	success:function(data){
		layer.close(index)
		layer.msg(data.msg);
		setTimeout(function(){
			location.href=data.url;
		},1500)
	}
});
      })
    }

    /*用户-停用*/
    function member_stop(obj,id) {
      layer.confirm('确认停用么?',function (index) {
        adminAjax('Get','{:url("api/base/changeStatu")}',util.jsonToUrlStr({"table":"agent_employee","id_name":"id","id_value":id, "field":"status","value":0}),false,function (index) {
          layer.msg("已停用",{
            icon:5,
            time:1000
          });
          $(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" class="btn btn-xs " onClick="member_start(this,'+id+')" href="javascript:;" title="正常"><i class="icon-ok bigger-120"></i></a>');
          $(obj).parents("tr").find(".td-status").html('<span class="label label-defaunt radius">已停用</span>');
          $(obj).remove();
        })
      })
    }


    /*员工-启用*/
    function member_start(obj,id) {
      layer.confirm('确认启用么',function (index) {
        adminAjax('Get','{:url("api/base/changeStatu")}',util.jsonToUrlStr({"table":"agent_employee","id_name":"id","id_value":id, "field":"status","value":1}),false,function (index){
          layer.msg("已启用",{
            icon:6,
            time:1000
          });
          $(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" class="btn btn-xs btn-success" onClick="member_stop(this,'+id+')" href="javascript:;" title="停用"><i class="icon-ok bigger-120"></i></a>');
          $(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">正常</span>');
          $(obj).remove();
        })
      });
    }


    /*格式化数据*/
    function serializeData(type) {

      var type=type||'add';
      var eles=$('*[data-role="add"]');
      var str='';
      var _d;
        /*获取物流的值*/
      var logisticVal=$('#select_logistics').val();


      for(var i=0;i<eles.length;i++){
        _d=$(eles[i]);
        if(_d.attr('type')=='radio'){
          if(_d.prop('checked')){
            str+=_d.attr('name')+'='+_d.val()+'&';
          }
        }else{
          str+=_d.attr('name')+'='+_d.val()+'&';
        }
      }
      str+='transport_code='+logisticVal;
      return str;
    }

</script>
<script>
  jQuery(function($) {

    $('table th input:checkbox').on('click', function() {
      var that = this;
      $(this).closest('table').find('tr > td:first-child input:checkbox')
        .each(function() {
          this.checked = that.checked;
          $(this).closest('tr').toggleClass('selected');
        });

    });
//  $('[data-rel="tooltip"]').tooltip({
//    placement: tooltip_placement
//  });
    function tooltip_placement(context, source) {
      var $source = $(source);
      var $parent = $source.closest('table')
      var off1 = $parent.offset();
      var w1 = $parent.width();

      var off2 = $source.offset();
      var w2 = $source.width();

      if (parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2)) return 'right';
      return 'left';
    }
  })
  /*打开面板方法*/
  function openPanle(type, id, fn){
    if(type == 'add'){
      //清空input
      $(".add_menber input[type$='text']").each(function(n) {
        $(this).val('');
      });
      $("#area_list").html('');
    }else{
      adminAjax('Get', '{:url('getTransById')}', util.jsonToUrlStr({"id": id}), false, function (res) {
        var data = res.data;
        var arrInput =$('#add_menber_style').find('input');
        var _e;
        for (var i=0;i<arrInput.length;i++){
          _e=$(arrInput[i]);
          if(_e.attr('type')=='radio'){
            if(data['status']=='正常'){
              $('#normal').prop('checked',true);
            }else if(data['status']){
              $('#forbidden').prop('checked',true);
            }
          }else{
            _e.val(data[_e.attr('name')]);
          }
        }
            /*显示下拉选择*/
        var transportVal =data['transport_code'];
        var arrOption =$('#select_logistics').find('option');
        var _o;
        var text;
        for (var i=0;i<arrOption.length;i++){
          _o=$(arrOption[i]);
            if(_o.val()==transportVal){
              _o.prop('selected',true);
              break;
            }
        }
        fn&&fn();
      }
    );
    }}

</script>
<script type="text/javascript">
	    /*用户编辑*/
    function member_edit(id) {
      console.log(id)
            var data = {'id':id};
      	$.ajax({
      		type:"Post",
      		data:data,
      		url:'{:url('getEmployeeById')}',
      		async:true,
      		success:function(data){
      			var input=$("#add_menber_style input[type=text]");
      			var radio=$("#add_menber_style input[type=radio]");
      			input.each(function(){
      				var name=$(this).attr('name');
      				$(this).val(data.data[name]);
      			})
				radio.each(function(){
					if ($(this).val()==data.data.status) {
						$(this).prop('checked','checked');
					}
				})
      		}
      	});
      layer.open({
        type: 1,
        title: '修改员工信息',
        maxmin: true,
        shadeClose: true, //点击遮罩关闭层
        area: ['600px', '400px'],
        content: $('#add_menber_style'),
        btn: ['提交', '取消'],
        yes: function(index, layero) {
          var bool=false;
          var json_={};
          var input;
          var password=$("#password");
          if(password.val()==""){
          	input=$('#add_menber_style input[type=text]')
          }
          else{
          	input=$('#add_menber_style input')
          	if (password.val()!=$("#confirm").val()&&!bool) {
          			layer.msg("请输入相同的密码");
          			bool=true;
          	}
          }
          if (bool) {
          	return false;
          }
          console.log(input)
          input.each(function(){
          		json_[$(this).attr('name')]=$(this).val();
          })
          var radio=$('#add_menber_style input[type=radio]');
          radio.each(function(){
          	if($(this).prop('checked')){
          		json_.status=$(this).val();
          	}
          })
          json_.id=id;
			$.ajax({
				type:"Post",
				url:'{:url('saveEmployee')}',
				async:true,
				data:json_,
				success:function(data){
					layer.close(index);
					layer.msg(data.msg);
			 		setTimeout(function(){location.href=data.url},1500);
					console.log(data);
				}
			});
        }
      });
    }
</script>
</body>
</html>
