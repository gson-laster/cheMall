<!-- page specific plugin scripts -->
<!--树状图-->
<script src="__ADMIN_STATIC__/assets/js/typeahead-bs2.min.js"></script>
<script src="__ADMIN_STATIC__/assets/layer/layer.js" type="text/javascript"></script>
<script src="__ADMIN_STATIC__/assets/laydate/laydate.js" type="text/javascript"></script>
<script type="text/javascript" src="__ADMIN_STATIC__/js/ajaxfileupload.js"></script>
<script src="__ADMIN_STATIC__/js/lrtk.js" type="text/javascript"></script>
<link rel="stylesheet" href="__ADMIN_STATIC__/css/style.css" />
<style>
    .user-lower-uper {
        margin-top: 20px;
        padding: 12px;
    }

    .user-lower-uper li {
        padding-left: 30px;
        position: relative;
    }

    .user-lower-uper li p {
        height: 32px;
        line-height: 32px;
    }

    .user-lower-uper li:before {
        content: "";
        width: 16px;
        height: 16px;
        position: absolute;
        left: 10px;
        top: 7px;
        background: url('__ADMIN_STATIC__/images/st_node.gif') no-repeat;
    }

    .user-lower-uper .list-1 {
        position: relative;
        line-height: 32px;
    }

    .user-lower-uper .list-1 i {
        display: inline-block;
        width: 10px;
        height: 10px;
        position: absolute;
        left: 0;
        top: 12px;
        background: url('__ADMIN_STATIC__/images/st_icon.png') no-repeat;
    }

    .user-lower-uper div.open i {
        background: url('__ADMIN_STATIC__/images/st_icon_open.png') no-repeat;
    }

    p>a {
        display: inline-block;
    }

    p>a:hover {
        color: red;
    }

    .public-user-list span {
        height: 32px;
        line-height: 32px;
    }

    .hasData>div>p {
        color: red;
    }


    .box {
        width: 100%;
    }

    .select-box a {
        display: block;
        width: 100px;
        height: 40px;
        text-align: center;
        line-height: 40px;
        color: #000;
        text-decoration: none;
        float: left;
        background-color: #f3f3f3;
    }

    .select-box a.label-info {
        color: #fff;
    }

    .logobox-container {
        position: absolute;
        right: 18%;
        top: 24%;
    }

    .delete-img {
        position: absolute;
        left: 0;
        top: 0;
        display: block;
        text-align: center;
        width: 100%;
        background: rgba(0, 0, 0, 0.4);
        color: #fff;
        cursor: pointer;
    }

    #upload img {
        width: 100%;
        max-height: 300px;
        max-width: 120px;
        /*height: 200px;*/
        overflow: hidden;
        text-align: center;
    }

    .logoupload .btnbox a {
        text-align: center;
        display: block;
        width: 100%;
    }
         .label_name{
      width: 160px !important;
    }
    #suoluetu{
      width: 100px;
      max-height: 100px;
      margin-left: 10px;
    }
    .thumb_pic img{
      width: 80px;
    }
     #imageBox li{
       float: left;
       border: 1px solid #C3C3C3;
       padding: 10px;
       margin: 10px;
       min-width: 100px;
       /*overflow: hidden;*/
       text-align: center;
       position: relative;
     }
    #imageBox img{
      height: 100px;
    }
    .page-content{
      margin-top: 20px;
    }
     .page-content li{
       padding-bottom: 20px;
     }
     .page-content input{
       width: 400px
     }
     .imgtatle{
       border: solid 1px #ddd;
       margin-top: 12px;
       min-height: 40px;
       padding: 12px;
     }
     .b-color{
       border: solid 1px #ddd;
       min-height: 40px;
       margin-bottom: 12px;
       
     }
     .file-panel{
       position: absolute;
       top: 0;
       left: 0;
       height: 36px;
       width: 100%;
       background: rgba(0, 0, 0, 0.5);
       color: #fff;
     }
     .file-panel span{
       padding-left: 4px !important;
       padding-top: 4px;
     }
     .file-panel img{
       height: 18px !important;
       vertical-align: middle;
     }
     .search_style{
         margin-bottom: 0;
         margin-top: 0;
     }
     .search_style .search_content li{
         line-height: 40px;
     }
</style>
<body>
    <div class="page-content clearfix">
        <div id="Member_Ratings">
            <div class="d_Confirm_Order_style">
                <div class="border">
                        <div class="search_style">
                                <ul class="search_content">
                                    <form action="{:url('applyOrderGoods')}" method="get">
                                        <li><label class="l_f">搜索</label><input name="keyword" type="text" class="text_add" value="" placeholder="请输入要查询的昵称或手机号" style=" width:400px"></li>
                                        <li style="width:90px;"><button type="submit" class="btn_search"><i class="fa fa-search"></i>查询</button></li>
                                    </form>
                                </ul>
                            </div>
                    <span class="r_f">共：<b>{:count($list)}</b>条</span>
                </div>
                <div class="table_menu_list">
                    <table class="table table-striped table-bordered table-hover" id="sample-table">
                        <thead>
                            <tr>
                                <th width="25"><label><input type="checkbox" onchange="changealls(this)" class="ace"><span class="lbl"></span></label></th>
                                <th width="80">ID</th>
                                <th width="180">申请人(申请人电话)</th>
                                <th width="150">申请充值额度</th>
                                <td width="150">充值单号</td>
                                <th width="140">审核员</th>
                                <th width="220">创建时间</th>
                                <th width="150">审核状态</th>
                                <th width="200">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                          {volist name="list" id="li"}
                          <tr>
                          <td><label><input type="checkbox" name="ids[]" value="{$li.id}" class="ace changeall"><span class="lbl"></span></label></td>
                               <td>{$li.id}</td>
                               <td>{$li.nickname | default = $li.wx_nickname}({$li.phone})</td>
                               <td>{$li.money}</td>
                               <td>{$li.ticket}</td>
                               <td>{$li.confirm_admin}</td>
                               <td>{$li.createtime|date="Y-m-d H:i:s",###}</td>
                               <td class="showStatus">
                                {switch name="li.status"}
                                  {case value="1"}<span class="label label-default">未审核</span>{/case}
                                  {case value="2"}<span class="label label-success">审核成功</span>{/case}
                                  {default/}<span class="label label-warning">驳回</span>
                                {/switch}
                               </td>
                               <td class="td-manage" style="text-align:left;"> 
                                  {switch name="li.status"}
                                    {case value="1"}
                                    <a href="javascript:;" class="btn btn-xs btn-success check" title="审核" data-status="2" onclick="verifyOrReject(this,{id:{$li.id}},0)">审核</a>
                                    <a href="javascript:;" class="btn btn-xs btn-success check" title="审核" data-status="2" onclick="verifyOrReject(this,{id:{$li.id}},3)">驳回</a>
                                    {/case}  
                                    {case value="2"}
                                    <a href="javascript:;" class="btn btn-xs btn-success">审核成功</a> 
                                    {/case}
                                    {default/}
                                    <a href="javascript:;" class="btn btn-xs btn-success check" title="审核" data-status="2" onclick="verifyOrReject(this,{id:{$li.id}},0)">审核</a>
                                    <a href="javascript:;" class="btn btn-xs btn-warning" title="驳回">已驳回</a>
                                  {/switch}
                                </td>
                            </tr>
                          {/volist}
                        </tbody>
                    </table>
                    {$list -> render()}
                </div>
            </div>
        </div>
    </div>
<script type="text/javascript">
	    //审核成功 
	    var sta = ['通过', '', '', '驳回'];
 function verifyOrReject(obj,options,isReject){
           layer.confirm('确认'+ sta[isReject] +'吗?',function (index) {
               var url = '{:url("doOrderGoods")}'
                var _this = $(obj)
                var status = isReject?3:2
                var admin='{:session("admin_info")["user_name"]}'
                options.status = status
                options.confirm_admin = admin  
                var ajaxOptions = {
                  url:url,
                  type:'POST',
                  data:options,
                  success:function(res){
                    var html='<a href="javascript:;" class="btn btn-xs btn-success">审核成功</a>'
                    if(res.code==2000){
                       layer.alert(res.msg,{
                         icon:1
                       })
                       _this.parent().html(html)
                       _this.parents('tr').find('.showStatus').html('<span class="label label-success">审核成功</span>')
                       _this.remove()
                       setTimeout(function(){
                         location.reload()
                       }, 1500)
                    }else{
                       layer.alert(res.msg,{
                         icon:2
                       }) 
                    }
                  },
                  error:function(xhr){
                    console.log(xhr);
                  }
                }  
                $.ajax(ajaxOptions)
           })
 } 
</script>